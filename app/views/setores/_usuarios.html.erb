<div class='containnerEquipes'>
<h2>Integrantes</h2>
	<table id='equipes'>
		<tr>
			<th>Nome</th>
			<th>Email</td>
			<th>Opção</td>
		</tr>
		<%@usuarios_do_setor.each do |usuario|%>
		<tr>
			<td><%=usuario.nome%></td>
			<td><%=usuario.email %></td>
			<%unless usuario.id == @setor.responsavel_id%>
			<td><button class='desassociar' id='<%=usuario.id%>'>Desassociar</button>
			<%else%>
			<td style='text-align:center'> - </td>
			<%end%>
		</tr>
		<%end%>
	</table>
<br />
<div id="dialog-usuario" title="Associar ao setor">
	<p class="validateTips">
		Escolha o usuário
	</p>
	<%= form_tag 'usuarios/adicionar_ao_setor' do%>
	<%= label_tag 'Usuário' %>
	<%= select_tag 'usuario_id', options_for_select(@usuarios), :class => "text ui-widget-content" %>
	<%= hidden_field_tag 'setor_id', @setor.id%>
	<%end%>
</div>

<button id='adicionar' <% if @usuarios.empty? %>disabled='disabled'<% end %>>
	Adicionar usuário
</button>
<script type="text/javascript">
$j(document).ready(function(){
	var setor = $j('#setor_id'),
		usuario = $j('#usuario_id');
	function toggleHeader()
	{
		if($j('#equipes tr td')[0] == undefined)
			{
				$j('#equipes tr th').toggle();
			}
	}
	function configuraBotoes(){
		$j(".desassociar").button().click(function(){
			$j.post('/usuarios/remover_de_setor',{usuario_id: $j(this).attr('id'), setor_id:'<%=@setor.id%>'});
			$j(this).parent().parent().remove();
			toggleHeader();
		});
	}
	configuraBotoes();
	toggleHeader();
	$j("#dialog:ui-dialog").dialog("destroy");
	
	$j("#dialog-usuario").dialog({
		autoOpen : false,
		height : 180,
		width : 350,
		modal : true,
		buttons : {
			"Salvar" : function() {
				$j.post('/usuarios/adicionar_ao_setor',
					{setor_id: setor.val(), usuario_id: usuario.val(), tipo:2},
					function(data){
						if(data['erro']){
							
						}else{
							toggleHeader();
							$j('#equipes tbody').append("<tr><td>"+data['nome']+"</td><td>"+data['email']+"</td><td><button class='desassociar' id='"+data['id']+"'>Desassociar</button></td></tr>");
							configuraBotoes();
						}
					});
				$j(this).dialog("close");
			},
			"Cancelar" : function() {
				$j(this).dialog("close");
			}
		},
		close : function() {
			//updateTips(tips, 'Digite o nome e o email do responsável.');
		}
	});
	$j("#adicionar").button().click(function() {
		$j("#dialog-usuario").dialog("open");
	});
	
});
</script>